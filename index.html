<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sundorica</title>
    <link rel="icon" href="https://i.postimg.cc/ZnQQvLz4/Chat-GPT-Image-Jun-30-2025-11-26-21-PM.png">
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>
    <iframe id="app-frame" src=""></iframe>

    <script>
        const iframe = document.getElementById('app-frame');
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbxPaNt_z0uRscltA5lyE_WTPogNs5d1mCqd7JDREyzJqUTHi0OPQlnh85f3ySpMTU4/exec'; 

        function route() {
            console.log("PARENT (GitHub): route() function called.");
            const params = new URLSearchParams(window.location.search);
            const sku = params.get('product');
            const newIframeSrc = sku ? `${appsScriptUrl}?product=${sku}` : appsScriptUrl;

            if (iframe.src !== newIframeSrc) {
                console.log("PARENT (GitHub): Updating iframe src to:", newIframeSrc);
                iframe.src = newIframeSrc;
            }
        }

        window.addEventListener('message', (event) => {
            console.log("PARENT (GitHub): Message received from iframe:", event.data);

            if (event.origin !== 'https://script.google.com') {
                console.warn("PARENT (GitHub): Message rejected due to origin mismatch. Expected 'https://script.google.com', but got:", event.origin);
                return;
            }

            const data = event.data;
            if (data.type === 'urlChange') {
                console.log("PARENT (GitHub): Message type is 'urlChange'. Preparing to update parent URL.");
                
                // Construct the new full URL
                const newUrl = new URL(window.location.origin + window.location.pathname);
                newUrl.search = data.path;

                console.log("PARENT (GitHub): New URL constructed:", newUrl.href);
                history.pushState({ sku: data.sku }, data.title, newUrl.href);
                document.title = data.title;
                console.log("PARENT (GitHub): Parent URL and title updated successfully.");
            }
        });
        
        window.addEventListener('popstate', route);
        route(); // Initial call to set the correct iframe source on page load
    </script>
</body>
</html>
